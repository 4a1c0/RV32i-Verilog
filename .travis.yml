language: verilog

services:
  - docker

before_install:
  - docker build -t icarus-verilog .

jobs:
  include:
    - stage: Unit Tests                # naming the Tests stage
      name: "Arithmeticologic Tests"            # names the first Tests stage job
      script: docker run icarus-verilog /bin/sh -c "iverilog -o bin/al tb/arithmeticologic.v ; bin/al| tee /dev/fd/2 | grep -q 'FATAL' && exit 1 || exit 0;"
    - stage: Unit Tests                # naming the Tests stage
      name: "Some Tests"     # names the second Tests stage job
      script: docker run icarus-verilog /bin/sh -c "iverilog -o bin/ls tb/load_store.v ; bin/ls| tee /dev/fd/2 | grep -q 'FATAL' && exit 1 || exit 0;"
    # - stage: Unit Tests                # naming the Tests stage
    #   name: "Error example"     # names the second Tests stage job
    #   script: docker run icarus-verilog /bin/sh -c "iverilog -o bin/er tb/error_test.v ; bin/er | tee /dev/fd/2 | grep -q 'FATAL' && exit 1 || exit 0;"
    
    # - stage: build docker image
    #   script:
    #   - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    #   - docker build -t icarus-verilog .
    #   - docker images
    #   - docker tag icarus-verilog $DOCKER_USERNAME/icarus-verilog
    #   - docker push $DOCKER_USERNAME/icarus-verilog